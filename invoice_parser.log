2024-11-10 20:13:34,640 - DEBUG - load_ssl_context verify=True cert=None trust_env=True http2=False
2024-11-10 20:13:34,646 - DEBUG - load_verify_locations cafile='C:\\Users\\rahul\\OneDrive\\Desktop\\Azure_Functions\\.venv\\Lib\\site-packages\\certifi\\cacert.pem'
2024-11-10 20:13:34,655 - INFO - Starting processing of C:/Users/rahul/Downloads/RESTAURANT DEPOT INVOICE 4.pdf
2024-11-10 20:13:34,710 - INFO - Request URL: 'https://invoiceparsing.cognitiveservices.azure.com/formrecognizer/documentModels/prebuilt-layout:analyze?stringIndexType=unicodeCodePoint&api-version=2023-07-31'
Request method: 'POST'
Request headers:
    'Content-Type': 'application/octet-stream'
    'Accept': 'application/json'
    'x-ms-client-request-id': '8e0f88d2-9fd2-11ef-a2b8-086ac515dfc8'
    'User-Agent': 'azsdk-python-ai-formrecognizer/3.3.3 Python/3.11.0 (Windows-10-10.0.22631-SP0)'
    'Ocp-Apim-Subscription-Key': 'REDACTED'
A body is sent with the request
2024-11-10 20:13:34,712 - DEBUG - Starting new HTTPS connection (1): invoiceparsing.cognitiveservices.azure.com:443
2024-11-10 20:13:35,090 - DEBUG - https://invoiceparsing.cognitiveservices.azure.com:443 "POST /formrecognizer/documentModels/prebuilt-layout:analyze?stringIndexType=unicodeCodePoint&api-version=2023-07-31 HTTP/11" 202 0
2024-11-10 20:13:35,090 - INFO - Response status: 202
Response headers:
    'Content-Length': '0'
    'Operation-Location': 'https://invoiceparsing.cognitiveservices.azure.com/formrecognizer/documentModels/prebuilt-layout/analyzeResults/53ca5bc5-53f9-4262-8b66-f1567671bfd1?api-version=2023-07-31'
    'x-envoy-upstream-service-time': '75'
    'apim-request-id': '53ca5bc5-53f9-4262-8b66-f1567671bfd1'
    'Strict-Transport-Security': 'max-age=31536000; includeSubDomains; preload'
    'x-content-type-options': 'nosniff'
    'x-ms-region': 'East US'
    'Date': 'Mon, 11 Nov 2024 02:13:34 GMT'
2024-11-10 20:13:35,102 - INFO - Request URL: 'https://invoiceparsing.cognitiveservices.azure.com/formrecognizer/documentModels/prebuilt-layout/analyzeResults/53ca5bc5-53f9-4262-8b66-f1567671bfd1?api-version=2023-07-31'
Request method: 'GET'
Request headers:
    'x-ms-client-request-id': '8e0f88d2-9fd2-11ef-a2b8-086ac515dfc8'
    'User-Agent': 'azsdk-python-ai-formrecognizer/3.3.3 Python/3.11.0 (Windows-10-10.0.22631-SP0)'
    'Ocp-Apim-Subscription-Key': 'REDACTED'
No body was attached to the request
2024-11-10 20:13:35,170 - DEBUG - https://invoiceparsing.cognitiveservices.azure.com:443 "GET /formrecognizer/documentModels/prebuilt-layout/analyzeResults/53ca5bc5-53f9-4262-8b66-f1567671bfd1?api-version=2023-07-31 HTTP/11" 200 106
2024-11-10 20:13:35,170 - INFO - Response status: 200
Response headers:
    'Content-Length': '106'
    'Content-Type': 'application/json; charset=utf-8'
    'retry-after': '3'
    'x-envoy-upstream-service-time': '20'
    'apim-request-id': 'd099b1b0-00f2-4b6e-a634-19b24ef48c5c'
    'Strict-Transport-Security': 'max-age=31536000; includeSubDomains; preload'
    'x-content-type-options': 'nosniff'
    'x-ms-region': 'East US'
    'Date': 'Mon, 11 Nov 2024 02:13:34 GMT'
2024-11-10 20:13:38,179 - INFO - Request URL: 'https://invoiceparsing.cognitiveservices.azure.com/formrecognizer/documentModels/prebuilt-layout/analyzeResults/53ca5bc5-53f9-4262-8b66-f1567671bfd1?api-version=2023-07-31'
Request method: 'GET'
Request headers:
    'x-ms-client-request-id': '8e0f88d2-9fd2-11ef-a2b8-086ac515dfc8'
    'User-Agent': 'azsdk-python-ai-formrecognizer/3.3.3 Python/3.11.0 (Windows-10-10.0.22631-SP0)'
    'Ocp-Apim-Subscription-Key': 'REDACTED'
No body was attached to the request
2024-11-10 20:13:38,269 - DEBUG - https://invoiceparsing.cognitiveservices.azure.com:443 "GET /formrecognizer/documentModels/prebuilt-layout/analyzeResults/53ca5bc5-53f9-4262-8b66-f1567671bfd1?api-version=2023-07-31 HTTP/11" 200 135891
2024-11-10 20:13:38,396 - INFO - Response status: 200
Response headers:
    'Content-Length': '135891'
    'Content-Type': 'application/json; charset=utf-8'
    'x-envoy-upstream-service-time': '37'
    'apim-request-id': '81755d40-b0b3-48cf-b549-22092d19fd4e'
    'Strict-Transport-Security': 'max-age=31536000; includeSubDomains; preload'
    'x-content-type-options': 'nosniff'
    'x-ms-region': 'East US'
    'Date': 'Mon, 11 Nov 2024 02:13:37 GMT'
2024-11-10 20:13:38,501 - INFO - Extracted content from 1 pages{1: {'text': ['Restaurant Depot 458 ,', 'BLUE LINE ELITE LLC', '6551,LINCOLN ST', 'HOLLYWOOD, FL 330247639', 'Terminal 12 - 09/16/2024 9:03 am', 'Invoice 6928', 'UPC', 'UnitQty', 'CaseQty', 'Price', 'Description', '$1,705.68', '-2 Previous Balance', '0', '0', '85685600629 FRZ .75-1 SNAPPER 10LB', '$65.49', '1', '0', '$65.49', '85685600629 FRZ .75-1 SNAPPER 10LB', '1', '0', '$65.49', '85685600629 FRZ .75-1 SNAPPER 10LB', '0', '1', '$56.39', '85685600647 WAHOO 10-12Z STK 10LB', '0', '1', '$56.39', '85685600647 WAHOO 10-12Z STK 10LB', '1', '0', '$56.39', '85685600647 WAHOO 10-12Z STK 10LB', '0', '1', '$9.67', '74069580120 PROD PARS ITL 24CT', '0', '1', '2740054508 MARG CCROCK TUB 5LBS', '$9.13', '0', '1', '79408 (Coupon) Country Crock Tub 5Lb', '($2.50)', '1', '0', '1995200011 CRP2LBWB CAFE PZ W HL BEA', '$11.49', '1', '0', '79195 (Coupon) Cuban Espresso Cafe Perez Whl Bean', '($5.00)', '0', '1', '20597640000 CHS SMK GOUDA AMLD R/W', '$21.66', '3.2', '0', 'GAL', '$14.04', '4430012672 SOY SAUCE LC', '0', '1', '$12.25', '7232301969 CAFE LA LLAVE', '10OZ', '1', '0', '$9.64', '74069580102 PROD CILANTRO 4-24', '1', '0', '$20.68', '76293599762 BAG POLY CL 6.5X8 2M CT', '1', '0', '$93.55', '3080225687 CHIX BNLS TRIMMED 10LB', '0', '1', '$38.82', '2570071377 ZIPLOC FREEZER', '0', '1GAL', '1', '$71.62', '20772040000 BF RIB/LIFTER', 'R/W', '15.95', '0', '17.99', '$80.77', '20772040000 BF RIB/LIFTER', 'R/W', '0', '20816450000 BF HAL 90/10 GRIND R/W', '$20.47', '5.08', '0', '$71.84', '20772040000 BF RIB/LIFTER R/W', '16', '0', '20816450000 BF HAL 90/10 GRIND R/W', '$20.03', '4.97', '0', '$25.76', '81004390292 MUSSEL MEAT CHILE 5LB', '0', '1', '$25.76', '81004390292 MUSSEL MEAT CHILE 5LB', '0', '1', '$100.02', '81004390224 SHR 250/350 C-PUD 5LB', '0', '1', '$9.36', '76069500000 CHS CREAM LOAF JF 3LB', '0', '1', '$10.34', '81004390122 SHR 21/25 R-PDTO 2LB', '1', '0', '$10.34', '81004390122 SHR 21/25 R-PDTO 2LB', '0', '1', '81004390122 SHR 21/25 R-PDTO', '2LB', '$10.34', '0', '1', '85742800686 SEAFOOD MIX 3LB', '$10.20', '3LB', '0', '1', '$10.20', '85742800686 SEAFOOD MIX 3LB', '3LB', '0', '1', '$1,076.12', '0 Sub-Total', '0', '0', '$0.00', '0 Tax', '0', '0', '$1,076.12', '0 Total', '0', '0', '0 Balance', '$1,076.12', '0', '0'], 'tables': ['Invoice 6928 UPC\tTerminal 12 - 09/16/2024 9:03 am\nDescription\tUnitQty\tCaseQty\tPrice\n-2\tPrevious Balance\t0\t0\t$1,705.68\n85685600629 FRZ .75-1 SNAPPER 10LB\t\t1\t0\t$65.49\n85685600629\tFRZ .75-1 SNAPPER 10LB\t1\t0\t$65.49\n85685600629\tFRZ .75-1 SNAPPER 10LB\t1\t0\t$65.49\n85685600647\tWAHOO 10-12Z STK 10LB\t1\t0\t$56.39\n85685600647\tWAHOO 10-12Z STK 10LB\t1\t0\t$56.39\n85685600647\tWAHOO 10-12Z STK 10LB\t1\t0\t$56.39\n74069580120\tPROD PARS ITL 24CT\t1\t0\t$9.67\n2740054508\tMARG CCROCK TUB 5LBS\t1\t0\t$9.13\n79408\t(Coupon) Country Crock Tub 5Lb\t1\t0\t($2.50)\n1995200011 CRP2LBWB CAFE PZ W HL BEA\t\t1\t0\t$11.49\n79195\t(Coupon) Cuban Espresso Cafe Perez Whl Bean\t1\t0\t($5.00)\n20597640000\tCHS SMK GOUDA AMLD R/W\t3.2\t0\t$21.66\n4430012672\tSOY SAUCE LC GAL\t1\t0\t$14.04\n7232301969\tCAFE LA LLAVE 10OZ\t1\t0\t$12.25\n74069580102\tPROD CILANTRO 4-24\t1\t0\t$9.64\n76293599762\tBAG POLY CL 6.5X8 2M CT\t1\t0\t$20.68\n3080225687\tCHIX BNLS TRIMMED 10LB\t0\t1\t$93.55\n2570071377\tZIPLOC FREEZER 1GAL\t1\t0\t$38.82\n20772040000\tBF RIB/LIFTER R/W\t15.95\t0\t$71.62\n20772040000\tBF RIB/LIFTER R/W\t17.99\t0\t$80.77\n20816450000\tBF HAL 90/10 GRIND R/W\t5.08\t0\t$20.47\n20772040000\tBF RIB/LIFTER R/W\t16\t0\t$71.84\n20816450000\tBF HAL 90/10 GRIND R/W\t4.97\t0\t$20.03\n81004390292\tMUSSEL MEAT CHILE 5LB\t0\t1\t$25.76\n81004390292\tMUSSEL MEAT CHILE 5LB\t0\t1\t$25.76\n81004390224\tSHR 250/350 C-PUD 5LB\t0\t1\t$100.02\n76069500000\tCHS CREAM LOAF JF 3LB\t1\t0\t$9.36\n81004390122\tSHR 21/25 R-PDTO 2LB\t1\t0\t$10.34\n81004390122\tSHR 21/25 R-PDTO 2LB\t1\t0\t$10.34\n81004390122\tSHR 21/25 R-PDTO 2LB\t1\t0\t$10.34\n85742800686\tSEAFOOD MIX 3LB 3LB\t1\t0\t$10.20\n85742800686\tSEAFOOD MIX 3LB 3LB\t1\t0\t$10.20\n0\tSub-Total\t0\t0\t$1,076.12\n0\tTax\t0\t0\t$0.00\n0\tTotal\t0\t0\t$1,076.12\n0\n:unselected:\tBalance\t0\t0\t$1,076.12']}}
2024-11-10 20:13:38,510 - INFO - Processing page 1 with 1 tables
2024-11-10 20:13:38,511 - INFO - Page 1 - Text lines: 167
2024-11-10 20:13:38,511 - INFO - Formatted page 1 content length: 4390
2024-11-10 20:13:38,515 - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'role': 'system', 'content': 'You are an expert invoice analysis AI specialized in wholesale produce invoices. Your task is to:\n1. Extract structured information with 100% accuracy\n2. Maintain data integrity across all fields\n3. Apply standardized validation rules\n4. Handle missing data according to specific rules\n5. Ensure all calculations are precise and verified\n6.Extract the all the items even it has duplicates and'}, {'role': 'user', 'content': '\nDETAILED INVOICE ANALYSIS INSTRUCTIONS:\n\n1. HEADER INFORMATION\n   Extract these specific fields:\n\n   A. Basic Invoice Information\n      • Supplier Name\n        Headers to check:\n        - "Vendor:", "Supplier:", "From:", "Sold By:"\n        Rules:\n        - Use FIRST supplier name found\n        - Use EXACTLY same name throughout\n        - Don\'t modify or formalize\n      \n      • Sold to Address\n        Headers to check:\n        - "Sold To:", "Bill To:", "Customer:"\n        Format:\n        - Complete address with all components\n        - Include street, city, state, ZIP\n      \n      • Order Date\n        Headers to check:\n        - "Order Date:", "Date Ordered:", "PO Date:"\n        Format: YYYY-MM-DD\n      \n      • Ship Date\n        Headers to check:\n        - "Ship Date:", "Delivery Date:", "Shipped:"\n        Format: YYYY-MM-DD\n      \n      • Invoice Number\n        Headers to check:\n        - Search for "Invoice Numbers" in the text like "Invoice NO","Invoice No","Invoice Number","Invoice ID"\n        - "Invoice #:", "Invoice Number:", "Invoice ID:"\n        Rules:\n        - Include all digits/characters\n        - Keep leading zeros\n      \n      • Shipping Address\n        Headers to check:\n        - "Ship To:", "Deliver To:", "Destination:"\n        Format:\n        - Complete delivery address\n        - All address components included\n      \n      • Total\n        Headers to check:\n        - "Total:", "Amount Due:", "Balance Due:"\n        Rules:\n        - Must match sum of line items\n        - Include tax if listed\n        - Round to 2 decimals\n\n2. LINE ITEM DETAIL\n    Extract the all the items even it has duplicates and\n   Extract these fields for each item:\n\n   A. Basic Item Information\n      • Item Number\n        Headers to check:\n        -"Product Code:" -"Item Number:" -"SKU:" -"UPC:"\n        Rules:\n        - Keep full identifier\n        - Include leading zeros\n      \n      • Item Name\n        Headers to check:\n        - "Description:", "Product:", "Item:"\n        Rules:\n        - Include full description with measeurement as well\n        - Keep original format\n      \n      • Product Category\n        Classify as:\n        - PRODUCE: Fresh fruits/vegetables\n        - DAIRY: Milk, cheese, yogurt\n        - MEAT: Beef, pork, poultry\n        - SEAFOOD: Fish, shellfish\n        - Beverages: Sodas,juices,water\n        - Dry Grocery: Chips, candy, nuts,Canned goods, spices, sauces\n        - BAKERY: Bread, pastries, cakes\n        - FROZEN: Ice cream, meals, desserts\n        - paper goods and Disposables: Bags, napkins, plates, cups, utensils,packing materials\n        - liquor: Beer, wine, spirits\n        - Chemical: Soaps, detergents, supplies\n        - OTHER: Anything not in above categories\n\n   B. Quantity and Measurement Details\n      • Quantity Shipped\n        Headers to check:\n        - "Qty:", "Quantity:", "Shipped:"\n        Rules:\n        - Must be positive number\n        - Default to 1 if missing\n      \n      • Quantity In a Case\n        Headers to check:\n        - "Units/Case:", "Pack Size:", "Case Pack:"\n        Patterns to check:\n        -  24= "24 units"\n        - "24/12oz" = 24 units\n        - "2/12ct" = 24 units\n        Default: 1 if not found\n      \n      • Measurement Of Each Item\n        Headers to check:\n        - "Size:", "Weight:", "Volume:"\n        Extract from description:\n        - "5 LB BAG" → 5\n        - "32 OZ PKG" → 32\n      \n\n   B. Measurement Units:\n      • Measured In - Standard Units:\n        \n        WEIGHT:\n        - pounds: LB, LBS, #, POUND\n        - ounces: OZ, OUNCE\n        - kilos: KG, KILO\n        - grams: G, GM, GRAM\n\n        COUNT:\n        - each: EA, PC, CT, COUNT, PIECE\n        - case: CS, CASE, BX, BOX\n        - dozen: DOZ, DZ\n        - pack: PK, PACK, PKG\n        - bundle: BDL, BUNDLE\n\n        VOLUME:\n        - gallons: GAL, GALLON\n        - quarts: QT, QUART\n        - pints: PT, PINT\n        - fluid_ounces: FL OZ, FLOZ\n        - liters: L, LT, LTR\n        - milliliters: ML\n\n        CONTAINERS:\n        - cans: CN, CAN, #10 CAN\n        - jars: JR, JAR\n        - bottles: BTL, BOTTLE\n        - containers: CTN, CONT\n        - tubs: TB, TUB\n        - bags: BG, BAG\n\n        PRODUCE:\n        - bunch: BN, BCH, BUNCH\n        - head: HD, HEAD\n        - basket: BSK, BASKET\n        - crate: CRT, CRATE\n        - carton: CRTN, CARTON\n      \n      • Total Units Ordered\n        Calculate: Measurement of Each Item * Quantity In Case * Quantity Shipped\n        Example: 5lb * 10 per case * 2 cases = 100 pounds\n\n   C. Pricing Information\n      • Extended Price\n        Headers to check:\n        - "Ext Price:", "Total:", "Amount:"\n        Rules:\n        - Must equal Case Price * Quantity Shipped\n      \n      • Case Price\n        Headers to check:\n        - "Unit Price:", \n        Rules:\n        - Price for single Unit price \n      \n      • Cost of a Unit\n        Calculate: Extended Price ÷ Total Units Ordered\n        Example: $100 ÷ 100 pounds = $1.00/lb\n      \n      • Currency\n        Default: "USD" if not specified\n\n      • Cost of Each Item\n        Cost of Each Item is calculated by Cost of Each Item=Cost of a unit* Measurement of each item\n        Verfiy by (Extended Price*Mesurement of each item)/Total Units Ordered\n        Default: if not specified "N/A"\n       \n\n   D. Additional Attributes\n      • Catch Weight:\n        If the item number is same in the previous item and quantity shipped is different then set "YES" \n         else N/A\n\n      \n      • Priced By\n       Look for the reference "Measured in" \n        Values:\n        - "per pound"\n        - "per case"\n        - "per each"\n        - "per dozen"\n        - "per Ounce"\n      \n      • Splitable\n        -Set "YES" if:\n        -if you have "YES" reference to Splitable\n\n        Set "NO" if:\n        - if you have "NO" reference to Splitable\n\n        Set "NO" if:\n        - Bulk only\n        - Single unit\n      \n      • Split Price\n        If Splitable = "YES":\n        - Calculate: Case Price ÷ Quantity In Case\n        If Splitable = "NO":\n        - Use "N/A"\n\n3. VALIDATION RULES\n   • Numeric Checks:\n     - All quantities must be positive\n     - All prices must be positive\n     - Total must match sum of line items\n   \n   • Required Fields:\n     - Supplier Name\n     - Invoice Number\n     - Total Amount\n     - Item Name\n     - Extended Price\n   \n   • Default Values:\n     - Quantity: 1.0\n     - Currency: "USD"\n     - Split Price: "N/A"\n     - Category: "OTHER"\n\nOUTPUT FORMAT:\nReturn a JSON array containing each invoice as an object matching this template:\n{\n  "Supplier Name": "",\n  "Sold to Address": "",\n  "Order Date": "",\n  "Ship Date": "",\n  "Invoice Number": "",\n  "Shipping Address": "",\n  "Total": 0,\n  "List of Items": [\n    {\n      "Item Number": "",\n      "Item Name": "",\n      "Product Category": "",\n      "Quantity Shipped": 1.0,\n      "Extended Price": 1.0,\n      "Quantity In a Case": 1.0,\n      "Measurement Of Each Item": 1.0,\n      "Measured In": "",\n      "Total Units Ordered": 1.0,\n      "Case Price": 0,\n      "Catch Weight": "",\n      "Priced By": "",\n      "Splitable": "",\n      "Split Price": "N/A",\n      "Cost of a Unit": 1.0,\n      "Currency": "",\n      "Cost of Each Item": 1.0\n    }\n  ]\n}INVOICE TEXT TO PROCESS:\n\n----- Page 1 Start -----\n\nTEXT CONTENT:\n1:Restaurant Depot 458 ,\n2:BLUE LINE ELITE LLC\n3:6551,LINCOLN ST\n4:HOLLYWOOD, FL 330247639\n5:Terminal 12 - 09/16/2024 9:03 am\n6:Invoice 6928\n7:UPC\n8:UnitQty\n9:CaseQty\n10:Price\n11:Description\n12:$1,705.68\n13:-2 Previous Balance\n14:0\n15:0\n16:85685600629 FRZ .75-1 SNAPPER 10LB\n17:$65.49\n18:1\n19:0\n20:$65.49\n21:85685600629 FRZ .75-1 SNAPPER 10LB\n22:1\n23:0\n24:$65.49\n25:85685600629 FRZ .75-1 SNAPPER 10LB\n26:0\n27:1\n28:$56.39\n29:85685600647 WAHOO 10-12Z STK 10LB\n30:0\n31:1\n32:$56.39\n33:85685600647 WAHOO 10-12Z STK 10LB\n34:1\n35:0\n36:$56.39\n37:85685600647 WAHOO 10-12Z STK 10LB\n38:0\n39:1\n40:$9.67\n41:74069580120 PROD PARS ITL 24CT\n42:0\n43:1\n44:2740054508 MARG CCROCK TUB 5LBS\n45:$9.13\n46:0\n47:1\n48:79408 (Coupon) Country Crock Tub 5Lb\n49:($2.50)\n50:1\n51:0\n52:1995200011 CRP2LBWB CAFE PZ W HL BEA\n53:$11.49\n54:1\n55:0\n56:79195 (Coupon) Cuban Espresso Cafe Perez Whl Bean\n57:($5.00)\n58:0\n59:1\n60:20597640000 CHS SMK GOUDA AMLD R/W\n61:$21.66\n62:3.2\n63:0\n64:GAL\n65:$14.04\n66:4430012672 SOY SAUCE LC\n67:0\n68:1\n69:$12.25\n70:7232301969 CAFE LA LLAVE\n71:10OZ\n72:1\n73:0\n74:$9.64\n75:74069580102 PROD CILANTRO 4-24\n76:1\n77:0\n78:$20.68\n79:76293599762 BAG POLY CL 6.5X8 2M CT\n80:1\n81:0\n82:$93.55\n83:3080225687 CHIX BNLS TRIMMED 10LB\n84:0\n85:1\n86:$38.82\n87:2570071377 ZIPLOC FREEZER\n88:0\n89:1GAL\n90:1\n91:$71.62\n92:20772040000 BF RIB/LIFTER\n93:R/W\n94:15.95\n95:0\n96:17.99\n97:$80.77\n98:20772040000 BF RIB/LIFTER\n99:R/W\n100:0\n101:20816450000 BF HAL 90/10 GRIND R/W\n102:$20.47\n103:5.08\n104:0\n105:$71.84\n106:20772040000 BF RIB/LIFTER R/W\n107:16\n108:0\n109:20816450000 BF HAL 90/10 GRIND R/W\n110:$20.03\n111:4.97\n112:0\n113:$25.76\n114:81004390292 MUSSEL MEAT CHILE 5LB\n115:0\n116:1\n117:$25.76\n118:81004390292 MUSSEL MEAT CHILE 5LB\n119:0\n120:1\n121:$100.02\n122:81004390224 SHR 250/350 C-PUD 5LB\n123:0\n124:1\n125:$9.36\n126:76069500000 CHS CREAM LOAF JF 3LB\n127:0\n128:1\n129:$10.34\n130:81004390122 SHR 21/25 R-PDTO 2LB\n131:1\n132:0\n133:$10.34\n134:81004390122 SHR 21/25 R-PDTO 2LB\n135:0\n136:1\n137:81004390122 SHR 21/25 R-PDTO\n138:2LB\n139:$10.34\n140:0\n141:1\n142:85742800686 SEAFOOD MIX 3LB\n143:$10.20\n144:3LB\n145:0\n146:1\n147:$10.20\n148:85742800686 SEAFOOD MIX 3LB\n149:3LB\n150:0\n151:1\n152:$1,076.12\n153:0 Sub-Total\n154:0\n155:0\n156:$0.00\n157:0 Tax\n158:0\n159:0\n160:$1,076.12\n161:0 Total\n162:0\n163:0\n164:0 Balance\n165:$1,076.12\n166:0\n167:0\n\n----- Table 1 Start -----\n\nHeader: Invoice 6928 UPC\tTerminal 12 - 09/16/2024 9:03 am\nRow 1: Description\tUnitQty\tCaseQty\tPrice\nRow 2: -2\tPrevious Balance\t0\t0\t$1,705.68\nRow 3: 85685600629 FRZ .75-1 SNAPPER 10LB\t\t1\t0\t$65.49\nRow 4: 85685600629\tFRZ .75-1 SNAPPER 10LB\t1\t0\t$65.49\nRow 5: 85685600629\tFRZ .75-1 SNAPPER 10LB\t1\t0\t$65.49\nRow 6: 85685600647\tWAHOO 10-12Z STK 10LB\t1\t0\t$56.39\nRow 7: 85685600647\tWAHOO 10-12Z STK 10LB\t1\t0\t$56.39\nRow 8: 85685600647\tWAHOO 10-12Z STK 10LB\t1\t0\t$56.39\nRow 9: 74069580120\tPROD PARS ITL 24CT\t1\t0\t$9.67\nRow 10: 2740054508\tMARG CCROCK TUB 5LBS\t1\t0\t$9.13\nRow 11: 79408\t(Coupon) Country Crock Tub 5Lb\t1\t0\t($2.50)\nRow 12: 1995200011 CRP2LBWB CAFE PZ W HL BEA\t\t1\t0\t$11.49\nRow 13: 79195\t(Coupon) Cuban Espresso Cafe Perez Whl Bean\t1\t0\t($5.00)\nRow 14: 20597640000\tCHS SMK GOUDA AMLD R/W\t3.2\t0\t$21.66\nRow 15: 4430012672\tSOY SAUCE LC GAL\t1\t0\t$14.04\nRow 16: 7232301969\tCAFE LA LLAVE 10OZ\t1\t0\t$12.25\nRow 17: 74069580102\tPROD CILANTRO 4-24\t1\t0\t$9.64\nRow 18: 76293599762\tBAG POLY CL 6.5X8 2M CT\t1\t0\t$20.68\nRow 19: 3080225687\tCHIX BNLS TRIMMED 10LB\t0\t1\t$93.55\nRow 20: 2570071377\tZIPLOC FREEZER 1GAL\t1\t0\t$38.82\nRow 21: 20772040000\tBF RIB/LIFTER R/W\t15.95\t0\t$71.62\nRow 22: 20772040000\tBF RIB/LIFTER R/W\t17.99\t0\t$80.77\nRow 23: 20816450000\tBF HAL 90/10 GRIND R/W\t5.08\t0\t$20.47\nRow 24: 20772040000\tBF RIB/LIFTER R/W\t16\t0\t$71.84\nRow 25: 20816450000\tBF HAL 90/10 GRIND R/W\t4.97\t0\t$20.03\nRow 26: 81004390292\tMUSSEL MEAT CHILE 5LB\t0\t1\t$25.76\nRow 27: 81004390292\tMUSSEL MEAT CHILE 5LB\t0\t1\t$25.76\nRow 28: 81004390224\tSHR 250/350 C-PUD 5LB\t0\t1\t$100.02\nRow 29: 76069500000\tCHS CREAM LOAF JF 3LB\t1\t0\t$9.36\nRow 30: 81004390122\tSHR 21/25 R-PDTO 2LB\t1\t0\t$10.34\nRow 31: 81004390122\tSHR 21/25 R-PDTO 2LB\t1\t0\t$10.34\nRow 32: 81004390122\tSHR 21/25 R-PDTO 2LB\t1\t0\t$10.34\nRow 33: 85742800686\tSEAFOOD MIX 3LB 3LB\t1\t0\t$10.20\nRow 34: 85742800686\tSEAFOOD MIX 3LB 3LB\t1\t0\t$10.20\nRow 35: 0\tSub-Total\t0\t0\t$1,076.12\nRow 36: 0\tTax\t0\t0\t$0.00\nRow 37: 0\tTotal\t0\t0\t$1,076.12\nRow 38: 0\nRow 39: :unselected:\tBalance\t0\t0\t$1,076.12\n----- Table 1 End -----\n\n----- Page 1 End -----\n\n'}], 'model': 'gpt-4o', 'max_tokens': 16000, 'temperature': 0.1}}
2024-11-10 20:13:38,526 - DEBUG - Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2024-11-10 20:13:38,526 - DEBUG - connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=5.0 socket_options=None
2024-11-10 20:13:38,757 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000194F34F0DD0>
2024-11-10 20:13:38,759 - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x00000194F3345BE0> server_hostname='api.openai.com' timeout=5.0
2024-11-10 20:13:38,790 - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000194F34F1210>
2024-11-10 20:13:38,793 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2024-11-10 20:13:38,793 - DEBUG - send_request_headers.complete
2024-11-10 20:13:38,793 - DEBUG - send_request_body.started request=<Request [b'POST']>
2024-11-10 20:13:38,793 - DEBUG - send_request_body.complete
2024-11-10 20:13:38,793 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2024-11-12 10:09:31,357 - DEBUG - load_ssl_context verify=True cert=None trust_env=True http2=False
2024-11-12 10:09:31,383 - DEBUG - load_verify_locations cafile='C:\\Users\\rahul\\OneDrive\\Desktop\\Azure_Functions\\.venv\\Lib\\site-packages\\certifi\\cacert.pem'
2024-11-12 10:09:31,388 - DEBUG - Using proactor: IocpProactor
2024-11-12 10:09:31,388 - INFO - Starting processing of C:/Users/rahul/Downloads/RESTAURANT DEPOT INVOICE 4.pdf
2024-11-12 10:09:31,404 - INFO - Request URL: 'https://invoiceparsing.cognitiveservices.azure.com/formrecognizer/documentModels/prebuilt-layout:analyze?stringIndexType=unicodeCodePoint&api-version=2023-07-31'
Request method: 'POST'
Request headers:
    'Content-Type': 'application/octet-stream'
    'Accept': 'application/json'
    'x-ms-client-request-id': '80316f87-a110-11ef-b5bf-086ac515dfc8'
    'User-Agent': 'azsdk-python-ai-formrecognizer/3.3.3 Python/3.11.0 (Windows-10-10.0.22631-SP0)'
    'Ocp-Apim-Subscription-Key': 'REDACTED'
A body is sent with the request
2024-11-12 10:09:31,412 - DEBUG - Starting new HTTPS connection (1): invoiceparsing.cognitiveservices.azure.com:443
2024-11-12 10:09:31,786 - DEBUG - https://invoiceparsing.cognitiveservices.azure.com:443 "POST /formrecognizer/documentModels/prebuilt-layout:analyze?stringIndexType=unicodeCodePoint&api-version=2023-07-31 HTTP/11" 202 0
2024-11-12 10:09:31,786 - INFO - Response status: 202
Response headers:
    'Content-Length': '0'
    'Operation-Location': 'https://invoiceparsing.cognitiveservices.azure.com/formrecognizer/documentModels/prebuilt-layout/analyzeResults/e48e23b4-cdef-4c28-a947-eaa8cf2d18ef?api-version=2023-07-31'
    'x-envoy-upstream-service-time': '71'
    'apim-request-id': 'e48e23b4-cdef-4c28-a947-eaa8cf2d18ef'
    'Strict-Transport-Security': 'max-age=31536000; includeSubDomains; preload'
    'x-content-type-options': 'nosniff'
    'x-ms-region': 'East US'
    'Date': 'Tue, 12 Nov 2024 16:12:32 GMT'
2024-11-12 10:09:31,802 - INFO - Request URL: 'https://invoiceparsing.cognitiveservices.azure.com/formrecognizer/documentModels/prebuilt-layout/analyzeResults/e48e23b4-cdef-4c28-a947-eaa8cf2d18ef?api-version=2023-07-31'
Request method: 'GET'
Request headers:
    'x-ms-client-request-id': '80316f87-a110-11ef-b5bf-086ac515dfc8'
    'User-Agent': 'azsdk-python-ai-formrecognizer/3.3.3 Python/3.11.0 (Windows-10-10.0.22631-SP0)'
    'Ocp-Apim-Subscription-Key': 'REDACTED'
No body was attached to the request
2024-11-12 10:09:31,869 - DEBUG - https://invoiceparsing.cognitiveservices.azure.com:443 "GET /formrecognizer/documentModels/prebuilt-layout/analyzeResults/e48e23b4-cdef-4c28-a947-eaa8cf2d18ef?api-version=2023-07-31 HTTP/11" 200 106
2024-11-12 10:09:31,869 - INFO - Response status: 200
Response headers:
    'Content-Length': '106'
    'Content-Type': 'application/json; charset=utf-8'
    'retry-after': '3'
    'x-envoy-upstream-service-time': '18'
    'apim-request-id': 'da7d2243-810f-43aa-a30d-a97fa69a8d5d'
    'Strict-Transport-Security': 'max-age=31536000; includeSubDomains; preload'
    'x-content-type-options': 'nosniff'
    'x-ms-region': 'East US'
    'Date': 'Tue, 12 Nov 2024 16:12:32 GMT'
2024-11-12 10:09:34,874 - INFO - Request URL: 'https://invoiceparsing.cognitiveservices.azure.com/formrecognizer/documentModels/prebuilt-layout/analyzeResults/e48e23b4-cdef-4c28-a947-eaa8cf2d18ef?api-version=2023-07-31'
Request method: 'GET'
Request headers:
    'x-ms-client-request-id': '80316f87-a110-11ef-b5bf-086ac515dfc8'
    'User-Agent': 'azsdk-python-ai-formrecognizer/3.3.3 Python/3.11.0 (Windows-10-10.0.22631-SP0)'
    'Ocp-Apim-Subscription-Key': 'REDACTED'
No body was attached to the request
2024-11-12 10:09:34,965 - DEBUG - https://invoiceparsing.cognitiveservices.azure.com:443 "GET /formrecognizer/documentModels/prebuilt-layout/analyzeResults/e48e23b4-cdef-4c28-a947-eaa8cf2d18ef?api-version=2023-07-31 HTTP/11" 200 135891
2024-11-12 10:09:35,088 - INFO - Response status: 200
Response headers:
    'Content-Length': '135891'
    'Content-Type': 'application/json; charset=utf-8'
    'x-envoy-upstream-service-time': '34'
    'apim-request-id': '14190a8f-7308-4dce-8a23-172459c1e51e'
    'Strict-Transport-Security': 'max-age=31536000; includeSubDomains; preload'
    'x-content-type-options': 'nosniff'
    'x-ms-region': 'East US'
    'Date': 'Tue, 12 Nov 2024 16:12:35 GMT'
2024-11-12 10:09:35,204 - INFO - Extracted content from 1 pages{1: {'text': ['Restaurant Depot 458 ,', 'BLUE LINE ELITE LLC', '6551,LINCOLN ST', 'HOLLYWOOD, FL 330247639', 'Terminal 12 - 09/16/2024 9:03 am', 'Invoice 6928', 'UPC', 'UnitQty', 'CaseQty', 'Price', 'Description', '$1,705.68', '-2 Previous Balance', '0', '0', '85685600629 FRZ .75-1 SNAPPER 10LB', '$65.49', '1', '0', '$65.49', '85685600629 FRZ .75-1 SNAPPER 10LB', '1', '0', '$65.49', '85685600629 FRZ .75-1 SNAPPER 10LB', '0', '1', '$56.39', '85685600647 WAHOO 10-12Z STK 10LB', '0', '1', '$56.39', '85685600647 WAHOO 10-12Z STK 10LB', '1', '0', '$56.39', '85685600647 WAHOO 10-12Z STK 10LB', '0', '1', '$9.67', '74069580120 PROD PARS ITL 24CT', '0', '1', '2740054508 MARG CCROCK TUB 5LBS', '$9.13', '0', '1', '79408 (Coupon) Country Crock Tub 5Lb', '($2.50)', '1', '0', '1995200011 CRP2LBWB CAFE PZ W HL BEA', '$11.49', '1', '0', '79195 (Coupon) Cuban Espresso Cafe Perez Whl Bean', '($5.00)', '0', '1', '20597640000 CHS SMK GOUDA AMLD R/W', '$21.66', '3.2', '0', 'GAL', '$14.04', '4430012672 SOY SAUCE LC', '0', '1', '$12.25', '7232301969 CAFE LA LLAVE', '10OZ', '1', '0', '$9.64', '74069580102 PROD CILANTRO 4-24', '1', '0', '$20.68', '76293599762 BAG POLY CL 6.5X8 2M CT', '1', '0', '$93.55', '3080225687 CHIX BNLS TRIMMED 10LB', '0', '1', '$38.82', '2570071377 ZIPLOC FREEZER', '0', '1GAL', '1', '$71.62', '20772040000 BF RIB/LIFTER', 'R/W', '15.95', '0', '17.99', '$80.77', '20772040000 BF RIB/LIFTER', 'R/W', '0', '20816450000 BF HAL 90/10 GRIND R/W', '$20.47', '5.08', '0', '$71.84', '20772040000 BF RIB/LIFTER R/W', '16', '0', '20816450000 BF HAL 90/10 GRIND R/W', '$20.03', '4.97', '0', '$25.76', '81004390292 MUSSEL MEAT CHILE 5LB', '0', '1', '$25.76', '81004390292 MUSSEL MEAT CHILE 5LB', '0', '1', '$100.02', '81004390224 SHR 250/350 C-PUD 5LB', '0', '1', '$9.36', '76069500000 CHS CREAM LOAF JF 3LB', '0', '1', '$10.34', '81004390122 SHR 21/25 R-PDTO 2LB', '1', '0', '$10.34', '81004390122 SHR 21/25 R-PDTO 2LB', '0', '1', '81004390122 SHR 21/25 R-PDTO', '2LB', '$10.34', '0', '1', '85742800686 SEAFOOD MIX 3LB', '$10.20', '3LB', '0', '1', '$10.20', '85742800686 SEAFOOD MIX 3LB', '3LB', '0', '1', '$1,076.12', '0 Sub-Total', '0', '0', '$0.00', '0 Tax', '0', '0', '$1,076.12', '0 Total', '0', '0', '0 Balance', '$1,076.12', '0', '0'], 'tables': ['Invoice 6928 UPC\tTerminal 12 - 09/16/2024 9:03 am\nDescription\tUnitQty\tCaseQty\tPrice\n-2\tPrevious Balance\t0\t0\t$1,705.68\n85685600629 FRZ .75-1 SNAPPER 10LB\t\t1\t0\t$65.49\n85685600629\tFRZ .75-1 SNAPPER 10LB\t1\t0\t$65.49\n85685600629\tFRZ .75-1 SNAPPER 10LB\t1\t0\t$65.49\n85685600647\tWAHOO 10-12Z STK 10LB\t1\t0\t$56.39\n85685600647\tWAHOO 10-12Z STK 10LB\t1\t0\t$56.39\n85685600647\tWAHOO 10-12Z STK 10LB\t1\t0\t$56.39\n74069580120\tPROD PARS ITL 24CT\t1\t0\t$9.67\n2740054508\tMARG CCROCK TUB 5LBS\t1\t0\t$9.13\n79408\t(Coupon) Country Crock Tub 5Lb\t1\t0\t($2.50)\n1995200011 CRP2LBWB CAFE PZ W HL BEA\t\t1\t0\t$11.49\n79195\t(Coupon) Cuban Espresso Cafe Perez Whl Bean\t1\t0\t($5.00)\n20597640000\tCHS SMK GOUDA AMLD R/W\t3.2\t0\t$21.66\n4430012672\tSOY SAUCE LC GAL\t1\t0\t$14.04\n7232301969\tCAFE LA LLAVE 10OZ\t1\t0\t$12.25\n74069580102\tPROD CILANTRO 4-24\t1\t0\t$9.64\n76293599762\tBAG POLY CL 6.5X8 2M CT\t1\t0\t$20.68\n3080225687\tCHIX BNLS TRIMMED 10LB\t0\t1\t$93.55\n2570071377\tZIPLOC FREEZER 1GAL\t1\t0\t$38.82\n20772040000\tBF RIB/LIFTER R/W\t15.95\t0\t$71.62\n20772040000\tBF RIB/LIFTER R/W\t17.99\t0\t$80.77\n20816450000\tBF HAL 90/10 GRIND R/W\t5.08\t0\t$20.47\n20772040000\tBF RIB/LIFTER R/W\t16\t0\t$71.84\n20816450000\tBF HAL 90/10 GRIND R/W\t4.97\t0\t$20.03\n81004390292\tMUSSEL MEAT CHILE 5LB\t0\t1\t$25.76\n81004390292\tMUSSEL MEAT CHILE 5LB\t0\t1\t$25.76\n81004390224\tSHR 250/350 C-PUD 5LB\t0\t1\t$100.02\n76069500000\tCHS CREAM LOAF JF 3LB\t1\t0\t$9.36\n81004390122\tSHR 21/25 R-PDTO 2LB\t1\t0\t$10.34\n81004390122\tSHR 21/25 R-PDTO 2LB\t1\t0\t$10.34\n81004390122\tSHR 21/25 R-PDTO 2LB\t1\t0\t$10.34\n85742800686\tSEAFOOD MIX 3LB 3LB\t1\t0\t$10.20\n85742800686\tSEAFOOD MIX 3LB 3LB\t1\t0\t$10.20\n0\tSub-Total\t0\t0\t$1,076.12\n0\tTax\t0\t0\t$0.00\n0\tTotal\t0\t0\t$1,076.12\n0\n:unselected:\tBalance\t0\t0\t$1,076.12']}}
2024-11-12 10:09:35,209 - INFO - Processing page 1 with 1 tables
2024-11-12 10:09:35,209 - INFO - Page 1 - Text lines: 167
2024-11-12 10:09:35,209 - INFO - Formatted page 1 content length: 4390
2024-11-12 10:09:35,238 - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'role': 'system', 'content': 'You are an expert invoice analysis AI specialized in wholesale produce invoices. Your task is to:\n1. Extract structured information with 100% accuracy\n2. Maintain data integrity across all fields\n3. Apply standardized validation rules\n4. Handle missing data according to specific rules\n5. Ensure all calculations are precise and verified\n6.Extract the all the items even it has duplicates and'}, {'role': 'user', 'content': '\nDETAILED INVOICE ANALYSIS INSTRUCTIONS:\n\n1. HEADER INFORMATION\n   Extract these specific fields:\n\n   A. Basic Invoice Information\n      • Supplier Name\n        Headers to check:\n        - "Vendor:", "Supplier:", "From:", "Sold By:"\n        Rules:\n        - Use FIRST supplier name found\n        - Use EXACTLY same name throughout\n        - Don\'t modify or formalize\n      \n      • Sold to Address\n        Headers to check:\n        - "Sold To:", "Bill To:", "Customer:"\n        Format:\n        - Complete address with all components\n        - Include street, city, state, ZIP\n      \n      • Order Date\n        Headers to check:\n        - "Order Date:", "Date Ordered:", "PO Date:"\n        Format: YYYY-MM-DD\n      \n      • Ship Date\n        Headers to check:\n        - "Ship Date:", "Delivery Date:", "Shipped:"\n        Format: YYYY-MM-DD\n      \n      • Invoice Number\n        Headers to check:\n        - Search for "Invoice Numbers" in the text like "Invoice NO","Invoice No","Invoice Number","Invoice ID"\n        - "Invoice #:", "Invoice Number:", "Invoice ID:"\n        Rules:\n        - Include all digits/characters\n        - Keep leading zeros\n      \n      • Shipping Address\n        Headers to check:\n        - "Ship To:", "Deliver To:", "Destination:"\n        Format:\n        - Complete delivery address\n        - All address components included\n      \n      • Total\n        Headers to check:\n        - "Total:", "Amount Due:", "Balance Due:"\n        Rules:\n        - Must match sum of line items\n        - Include tax if listed\n        - Round to 2 decimals\n\n2. LINE ITEM DETAIL\n    Extract the all the items even it has duplicates and\n   Extract these fields for each item:\n\n   A. Basic Item Information\n      • Item Number\n        Headers to check:\n        -"Product Code:" -"Item Number:" -"SKU:" -"UPC:"\n        Rules:\n        - Keep full identifier\n        - Include leading zeros\n      \n      • Item Name\n        Headers to check:\n        - "Description:", "Product:", "Item:"\n        Rules:\n        - Include full description with measeurement as well\n        - Keep original format\n      \n      • Product Category\n        Classify as:\n        - PRODUCE: Fresh fruits/vegetables\n        - DAIRY: Milk, cheese, yogurt\n        - MEAT: Beef, pork, poultry\n        - SEAFOOD: Fish, shellfish\n        - Beverages: Sodas,juices,water\n        - Dry Grocery: Chips, candy, nuts,Canned goods, spices, sauces\n        - BAKERY: Bread, pastries, cakes\n        - FROZEN: Ice cream, meals, desserts\n        - paper goods and Disposables: Bags, napkins, plates, cups, utensils,packing materials\n        - liquor: Beer, wine, spirits\n        - Chemical: Soaps, detergents, supplies\n        - OTHER: Anything not in above categories\n\n   B. Quantity and Measurement Details\n      • Quantity Shipped\n        Headers to check:\n        - "Qty:", "Quantity:", "Shipped:"\n        Rules:\n        - Must be positive number\n        - Default to 1 if missing\n      \n      • Quantity In a Case\n        Headers to check:\n        - "Units/Case:", "Pack Size:", "Case Pack:"\n        Patterns to check:\n        -  24= "24 units"\n        - "24/12oz" = 24 units\n        - "2/12ct" = 24 units\n        Default: 1 if not found\n      \n      • Measurement Of Each Item\n        Headers to check:\n        - "Size:", "Weight:", "Volume:"\n        Extract from description:\n        - "5 LB BAG" → 5\n        - "32 OZ PKG" → 32\n      \n\n   B. Measurement Units:\n      • Measured In - Standard Units:\n        \n        WEIGHT:\n        - pounds: LB, LBS, #, POUND\n        - ounces: OZ, OUNCE\n        - kilos: KG, KILO\n        - grams: G, GM, GRAM\n\n        COUNT:\n        - each: EA, PC, CT, COUNT, PIECE\n        - case: CS, CASE, BX, BOX\n        - dozen: DOZ, DZ\n        - pack: PK, PACK, PKG\n        - bundle: BDL, BUNDLE\n\n        VOLUME:\n        - gallons: GAL, GALLON\n        - quarts: QT, QUART\n        - pints: PT, PINT\n        - fluid_ounces: FL OZ, FLOZ\n        - liters: L, LT, LTR\n        - milliliters: ML\n\n        CONTAINERS:\n        - cans: CN, CAN, #10 CAN\n        - jars: JR, JAR\n        - bottles: BTL, BOTTLE\n        - containers: CTN, CONT\n        - tubs: TB, TUB\n        - bags: BG, BAG\n\n        PRODUCE:\n        - bunch: BN, BCH, BUNCH\n        - head: HD, HEAD\n        - basket: BSK, BASKET\n        - crate: CRT, CRATE\n        - carton: CRTN, CARTON\n      \n      • Total Units Ordered\n        Calculate: Measurement of Each Item * Quantity In Case * Quantity Shipped\n        Example: 5lb * 10 per case * 2 cases = 100 pounds\n\n   C. Pricing Information\n      • Extended Price\n        Headers to check:\n        - "Ext Price:", "Total:", "Amount:"\n        Rules:\n        - Must equal Case Price * Quantity Shipped\n      \n      • Case Price\n        Headers to check:\n        - "Unit Price:", \n        Rules:\n        - Price for single Unit price \n      \n      • Cost of a Unit\n        Calculate: Extended Price ÷ Total Units Ordered\n        Example: $100 ÷ 100 pounds = $1.00/lb\n      \n      • Currency\n        Default: "USD" if not specified\n\n      • Cost of Each Item\n        Cost of Each Item is calculated by Cost of Each Item=Cost of a unit* Measurement of each item\n        Verfiy by (Extended Price*Mesurement of each item)/Total Units Ordered\n        Default: if not specified "N/A"\n       \n\n   D. Additional Attributes\n      • Catch Weight:\n        If the item number is same in the previous item and quantity shipped is different then set "YES" \n         else N/A\n\n      \n      • Priced By\n       Look for the reference "Measured in" \n        Values:\n        - "per pound"\n        - "per case"\n        - "per each"\n        - "per dozen"\n        - "per Ounce"\n      \n      • Splitable\n        -Set "YES" if:\n        -if you have "YES" reference to Splitable\n\n        Set "NO" if:\n        - if you have "NO" reference to Splitable\n\n        Set "NO" if:\n        - Bulk only\n        - Single unit\n      \n      • Split Price\n        If Splitable = "YES":\n        - Calculate: Case Price ÷ Quantity In Case\n        If Splitable = "NO":\n        - Use "N/A"\n\n3. VALIDATION RULES\n   • Numeric Checks:\n     - All quantities must be positive\n     - All prices must be positive\n     - Total must match sum of line items\n   \n   • Required Fields:\n     - Supplier Name\n     - Invoice Number\n     - Total Amount\n     - Item Name\n     - Extended Price\n   \n   • Default Values:\n     - Quantity: 1.0\n     - Currency: "USD"\n     - Split Price: "N/A"\n     - Category: "OTHER"\n\nOUTPUT FORMAT:\nReturn a JSON array containing each invoice as an object matching this template:\n{\n  "Supplier Name": "",\n  "Sold to Address": "",\n  "Order Date": "",\n  "Ship Date": "",\n  "Invoice Number": "",\n  "Shipping Address": "",\n  "Total": 0,\n  "List of Items": [\n    {\n      "Item Number": "",\n      "Item Name": "",\n      "Product Category": "",\n      "Quantity Shipped": 1.0,\n      "Extended Price": 1.0,\n      "Quantity In a Case": 1.0,\n      "Measurement Of Each Item": 1.0,\n      "Measured In": "",\n      "Total Units Ordered": 1.0,\n      "Case Price": 0,\n      "Catch Weight": "",\n      "Priced By": "",\n      "Splitable": "",\n      "Split Price": "N/A",\n      "Cost of a Unit": 1.0,\n      "Currency": "",\n      "Cost of Each Item": 1.0\n    }\n  ]\n}INVOICE TEXT TO PROCESS:\n\n----- Page 1 Start -----\n\nTEXT CONTENT:\n1:Restaurant Depot 458 ,\n2:BLUE LINE ELITE LLC\n3:6551,LINCOLN ST\n4:HOLLYWOOD, FL 330247639\n5:Terminal 12 - 09/16/2024 9:03 am\n6:Invoice 6928\n7:UPC\n8:UnitQty\n9:CaseQty\n10:Price\n11:Description\n12:$1,705.68\n13:-2 Previous Balance\n14:0\n15:0\n16:85685600629 FRZ .75-1 SNAPPER 10LB\n17:$65.49\n18:1\n19:0\n20:$65.49\n21:85685600629 FRZ .75-1 SNAPPER 10LB\n22:1\n23:0\n24:$65.49\n25:85685600629 FRZ .75-1 SNAPPER 10LB\n26:0\n27:1\n28:$56.39\n29:85685600647 WAHOO 10-12Z STK 10LB\n30:0\n31:1\n32:$56.39\n33:85685600647 WAHOO 10-12Z STK 10LB\n34:1\n35:0\n36:$56.39\n37:85685600647 WAHOO 10-12Z STK 10LB\n38:0\n39:1\n40:$9.67\n41:74069580120 PROD PARS ITL 24CT\n42:0\n43:1\n44:2740054508 MARG CCROCK TUB 5LBS\n45:$9.13\n46:0\n47:1\n48:79408 (Coupon) Country Crock Tub 5Lb\n49:($2.50)\n50:1\n51:0\n52:1995200011 CRP2LBWB CAFE PZ W HL BEA\n53:$11.49\n54:1\n55:0\n56:79195 (Coupon) Cuban Espresso Cafe Perez Whl Bean\n57:($5.00)\n58:0\n59:1\n60:20597640000 CHS SMK GOUDA AMLD R/W\n61:$21.66\n62:3.2\n63:0\n64:GAL\n65:$14.04\n66:4430012672 SOY SAUCE LC\n67:0\n68:1\n69:$12.25\n70:7232301969 CAFE LA LLAVE\n71:10OZ\n72:1\n73:0\n74:$9.64\n75:74069580102 PROD CILANTRO 4-24\n76:1\n77:0\n78:$20.68\n79:76293599762 BAG POLY CL 6.5X8 2M CT\n80:1\n81:0\n82:$93.55\n83:3080225687 CHIX BNLS TRIMMED 10LB\n84:0\n85:1\n86:$38.82\n87:2570071377 ZIPLOC FREEZER\n88:0\n89:1GAL\n90:1\n91:$71.62\n92:20772040000 BF RIB/LIFTER\n93:R/W\n94:15.95\n95:0\n96:17.99\n97:$80.77\n98:20772040000 BF RIB/LIFTER\n99:R/W\n100:0\n101:20816450000 BF HAL 90/10 GRIND R/W\n102:$20.47\n103:5.08\n104:0\n105:$71.84\n106:20772040000 BF RIB/LIFTER R/W\n107:16\n108:0\n109:20816450000 BF HAL 90/10 GRIND R/W\n110:$20.03\n111:4.97\n112:0\n113:$25.76\n114:81004390292 MUSSEL MEAT CHILE 5LB\n115:0\n116:1\n117:$25.76\n118:81004390292 MUSSEL MEAT CHILE 5LB\n119:0\n120:1\n121:$100.02\n122:81004390224 SHR 250/350 C-PUD 5LB\n123:0\n124:1\n125:$9.36\n126:76069500000 CHS CREAM LOAF JF 3LB\n127:0\n128:1\n129:$10.34\n130:81004390122 SHR 21/25 R-PDTO 2LB\n131:1\n132:0\n133:$10.34\n134:81004390122 SHR 21/25 R-PDTO 2LB\n135:0\n136:1\n137:81004390122 SHR 21/25 R-PDTO\n138:2LB\n139:$10.34\n140:0\n141:1\n142:85742800686 SEAFOOD MIX 3LB\n143:$10.20\n144:3LB\n145:0\n146:1\n147:$10.20\n148:85742800686 SEAFOOD MIX 3LB\n149:3LB\n150:0\n151:1\n152:$1,076.12\n153:0 Sub-Total\n154:0\n155:0\n156:$0.00\n157:0 Tax\n158:0\n159:0\n160:$1,076.12\n161:0 Total\n162:0\n163:0\n164:0 Balance\n165:$1,076.12\n166:0\n167:0\n\n----- Table 1 Start -----\n\nHeader: Invoice 6928 UPC\tTerminal 12 - 09/16/2024 9:03 am\nRow 1: Description\tUnitQty\tCaseQty\tPrice\nRow 2: -2\tPrevious Balance\t0\t0\t$1,705.68\nRow 3: 85685600629 FRZ .75-1 SNAPPER 10LB\t\t1\t0\t$65.49\nRow 4: 85685600629\tFRZ .75-1 SNAPPER 10LB\t1\t0\t$65.49\nRow 5: 85685600629\tFRZ .75-1 SNAPPER 10LB\t1\t0\t$65.49\nRow 6: 85685600647\tWAHOO 10-12Z STK 10LB\t1\t0\t$56.39\nRow 7: 85685600647\tWAHOO 10-12Z STK 10LB\t1\t0\t$56.39\nRow 8: 85685600647\tWAHOO 10-12Z STK 10LB\t1\t0\t$56.39\nRow 9: 74069580120\tPROD PARS ITL 24CT\t1\t0\t$9.67\nRow 10: 2740054508\tMARG CCROCK TUB 5LBS\t1\t0\t$9.13\nRow 11: 79408\t(Coupon) Country Crock Tub 5Lb\t1\t0\t($2.50)\nRow 12: 1995200011 CRP2LBWB CAFE PZ W HL BEA\t\t1\t0\t$11.49\nRow 13: 79195\t(Coupon) Cuban Espresso Cafe Perez Whl Bean\t1\t0\t($5.00)\nRow 14: 20597640000\tCHS SMK GOUDA AMLD R/W\t3.2\t0\t$21.66\nRow 15: 4430012672\tSOY SAUCE LC GAL\t1\t0\t$14.04\nRow 16: 7232301969\tCAFE LA LLAVE 10OZ\t1\t0\t$12.25\nRow 17: 74069580102\tPROD CILANTRO 4-24\t1\t0\t$9.64\nRow 18: 76293599762\tBAG POLY CL 6.5X8 2M CT\t1\t0\t$20.68\nRow 19: 3080225687\tCHIX BNLS TRIMMED 10LB\t0\t1\t$93.55\nRow 20: 2570071377\tZIPLOC FREEZER 1GAL\t1\t0\t$38.82\nRow 21: 20772040000\tBF RIB/LIFTER R/W\t15.95\t0\t$71.62\nRow 22: 20772040000\tBF RIB/LIFTER R/W\t17.99\t0\t$80.77\nRow 23: 20816450000\tBF HAL 90/10 GRIND R/W\t5.08\t0\t$20.47\nRow 24: 20772040000\tBF RIB/LIFTER R/W\t16\t0\t$71.84\nRow 25: 20816450000\tBF HAL 90/10 GRIND R/W\t4.97\t0\t$20.03\nRow 26: 81004390292\tMUSSEL MEAT CHILE 5LB\t0\t1\t$25.76\nRow 27: 81004390292\tMUSSEL MEAT CHILE 5LB\t0\t1\t$25.76\nRow 28: 81004390224\tSHR 250/350 C-PUD 5LB\t0\t1\t$100.02\nRow 29: 76069500000\tCHS CREAM LOAF JF 3LB\t1\t0\t$9.36\nRow 30: 81004390122\tSHR 21/25 R-PDTO 2LB\t1\t0\t$10.34\nRow 31: 81004390122\tSHR 21/25 R-PDTO 2LB\t1\t0\t$10.34\nRow 32: 81004390122\tSHR 21/25 R-PDTO 2LB\t1\t0\t$10.34\nRow 33: 85742800686\tSEAFOOD MIX 3LB 3LB\t1\t0\t$10.20\nRow 34: 85742800686\tSEAFOOD MIX 3LB 3LB\t1\t0\t$10.20\nRow 35: 0\tSub-Total\t0\t0\t$1,076.12\nRow 36: 0\tTax\t0\t0\t$0.00\nRow 37: 0\tTotal\t0\t0\t$1,076.12\nRow 38: 0\nRow 39: :unselected:\tBalance\t0\t0\t$1,076.12\n----- Table 1 End -----\n\n----- Page 1 End -----\n\n'}], 'model': 'gpt-4o', 'max_tokens': 16000, 'temperature': 0.1}}
2024-11-12 10:09:35,252 - DEBUG - connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=5.0 socket_options=None
2024-11-12 10:09:35,298 - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000002B756BB46D0>
2024-11-12 10:09:35,299 - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x000002B756A9DBE0> server_hostname='api.openai.com' timeout=5.0
2024-11-12 10:09:35,320 - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000002B756BB4710>
2024-11-12 10:09:35,320 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2024-11-12 10:09:35,320 - DEBUG - send_request_headers.complete
2024-11-12 10:09:35,320 - DEBUG - send_request_body.started request=<Request [b'POST']>
2024-11-12 10:09:35,324 - DEBUG - send_request_body.complete
2024-11-12 10:09:35,324 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2024-11-12 10:09:35,421 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 401, b'Unauthorized', [(b'Date', b'Tue, 12 Nov 2024 16:12:36 GMT'), (b'Content-Type', b'application/json; charset=utf-8'), (b'Content-Length', b'345'), (b'Connection', b'keep-alive'), (b'vary', b'Origin'), (b'x-request-id', b'req_62063c080834ab71929e73b6186b3f47'), (b'strict-transport-security', b'max-age=31536000; includeSubDomains; preload'), (b'CF-Cache-Status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=DoBKMrRjBcXEkMYrgMAEXy10Bhset80Y8i.vq0H6DPo-1731427956-1.0.1.1-cfk61EqzfScdQeYcUGyRMIcnifnqJe2wAKQbHoJ.MsCqPGe99n.IbHLLWMMWpEUO.4DMuspXHDu0Cxr3zJb8HA; path=/; expires=Tue, 12-Nov-24 16:42:36 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=JpAe.a.HEkurw8VR8HpYp6FLwYKCQPNy1W6BKYz08Eg-1731427956957-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'8e17cdfa69e22ca6-DFW'), (b'alt-svc', b'h3=":443"; ma=86400')])
2024-11-12 10:09:35,421 - INFO - HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 401 Unauthorized"
2024-11-12 10:09:35,421 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2024-11-12 10:09:35,421 - DEBUG - receive_response_body.complete
2024-11-12 10:09:35,421 - DEBUG - response_closed.started
2024-11-12 10:09:35,421 - DEBUG - response_closed.complete
2024-11-12 10:09:35,421 - DEBUG - HTTP Request: POST https://api.openai.com/v1/chat/completions "401 Unauthorized"
2024-11-12 10:09:35,421 - DEBUG - Encountered httpx.HTTPStatusError
Traceback (most recent call last):
  File "C:\Users\rahul\OneDrive\Desktop\Azure_Functions\.venv\Lib\site-packages\openai\_base_client.py", line 1613, in _request
    response.raise_for_status()
  File "C:\Users\rahul\OneDrive\Desktop\Azure_Functions\.venv\Lib\site-packages\httpx\_models.py", line 763, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '401 Unauthorized' for url 'https://api.openai.com/v1/chat/completions'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/401
2024-11-12 10:09:35,445 - DEBUG - Not retrying
2024-11-12 10:09:35,445 - DEBUG - Re-raising status error
2024-11-12 10:09:35,445 - ERROR - Error processing with GPT: Error code: 401 - {'error': {'message': 'Incorrect API key provided: sk-Y-Nt5***********************************************************************************LsgA. You can find your API key at https://platform.openai.com/account/api-keys.', 'type': 'invalid_request_error', 'param': None, 'code': 'invalid_api_key'}}
2024-11-12 10:09:35,445 - INFO - Got result for page 1
